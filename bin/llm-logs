#!/bin/zsh

bin=$(dirname $(readlink -f $0))
parent=$(dirname $bin)

source $parent/config/config.sh

echo "üìã Available logs:"
echo "  1) llama-swap only"
echo "  2) Docker services (open-webui + searxng)"
echo "  3) All logs (combined)"
echo ""
read -p "Choose option (1-3) or Enter for llama-swap only: " choice

choice=${choice:-1}

case $choice in
1)
  echo "üìã Showing llama-swap logs..."
  if [ -f $parent/logs/llama-swap.log ]; then
    tail -f $parent/logs/llama-swap.log
  else
    echo "‚ùå llama-swap log not found"
  fi
  ;;
2)
  if [ -z "$ENABLE_OPEN_WEBUI" ]; then
    echo "Open-webui is not enabled"
    exit 1
  fi
  echo "üìã Showing Docker logs..."
  docker-compose logs -f
  ;;
*)
  echo "üìã Showing all logs..."
  if [ -f $parent/logs/llama-swap.log ]; then
    echo "=== llama-swap logs ==="
    tail -20 $parent/logs/llama-swap.log
    echo ""
  fi
  if [ -n "$ENABLE_OPEN_WEBUI" ]; then
    echo "=== Docker logs ==="
    docker-compose logs --tail=20
    echo ""
    echo "Following all logs... (Ctrl+C to stop)"
    {
      if [ -f $parent/logs/llama-swap.log ]; then
        tail -f $parent/logs/llama-swap.log | sed 's/^/[llama-swap] /' &
      fi
      docker-compose logs -f | sed 's/^/[docker] /' &
      wait
    }
  fi
  ;;
esac
