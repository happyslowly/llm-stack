#!/bin/zsh

bin=$(dirname $(readlink -f $0))
parent=$(dirname $bin)

source $parent/config/config.sh

echo "ğŸ“Š LLM Stack Status:"
echo ""

# Check llama-swap
if [ -f $parent/data/llama-swap.pid ]; then
  LLAMA_PID=$(cat $parent/data/llama-swap.pid)
  if ps -p $LLAMA_PID >/dev/null 2>&1; then
    echo "ğŸ¦™ llama-swap: âœ… Running (PID: $LLAMA_PID)"
    if curl -s http://localhost:12345/health &>/dev/null; then
      echo "   â””â”€ API: âœ… Responding on port 12345"
    else
      echo "   â””â”€ API: âš ï¸  Not responding on port 12345"
    fi
  else
    echo "ğŸ¦™ llama-swap: âŒ Not running"
  fi
else
  echo "ğŸ¦™ llama-swap: âŒ Not started"
fi

echo ""

if [ -n "$ENABLE_OPEN_WEBUI" ]; then
  # Check Docker services
  echo "ğŸ³ Docker Services:"
  docker-compose ps
fi

# Check ports
echo "ğŸŒ Port Status:"
if nc -z localhost 12345 2>/dev/null; then
  echo "   llama-swap (12345): âœ…"
else
  echo "   llama-swap (12345): âŒ"
fi

if [ -n "$ENABLE_OPEN_WEBUI" ]; then
  if nc -z localhost 3000 2>/dev/null; then
    echo "   Open WebUI (3000): âœ…"
  else
    echo "   Open WebUI (3000): âŒ"
  fi

  if nc -z localhost 3001 2>/dev/null; then
    echo "   SearXNG (3001):    âœ…"
  else
    echo "   SearXNG (3001):    âŒ"
  fi
fi
